# ============================================
# Configuration complète - Notification Service
# ============================================

spring.application.name=notification-service
server.port=8086

# ============================================
# Database Configuration
# ============================================
spring.datasource.url=jdbc:mariadb://localhost:3306/notification_db
spring.datasource.username=root
spring.datasource.password=amthroot
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# Connection Pool
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ============================================
# JPA/Hibernate Configuration
# ============================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true

# ============================================
# Eureka Client Configuration
# ============================================
eureka.client.service-url.defaultZone=http://eureka:eureka123@localhost:8761/eureka/,http://eureka:eureka123@localhost:8762/eureka/
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90

# ============================================
# Security & JWT Configuration
# ============================================
jwt.secret=s3cR3tK3y!#2025@JWT_Sign4tur3!!VeryLongSecretKeyForHS512Algorithm2025!!
jwt.expiration=86400000
jwt.issuer=user-service

# CORS Configuration
cors.allowed-origins=http://localhost:4200,http://localhost:8080
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true

# ============================================
# Kafka Configuration
# ============================================
spring.kafka.bootstrap-servers=localhost:9092

# Consumer Configuration
spring.kafka.consumer.group-id=notification-service
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.properties.spring.json.type.mapping=notificationEvent:ma.emsi.notificationservice.dto.NotificationEvent

# Producer Configuration (for DLQ)
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer

# Kafka Topics
kafka.topic.notification-events=notification-events
kafka.topic.notification-dlq=notification-dlq
kafka.topic.inscription-events=inscription-events
kafka.topic.soutenance-events=soutenance-events

# ============================================
# Mail Configuration
# ============================================
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=your-email@gmail.com
spring.mail.password=your-app-password
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Mail settings
mail.from=noreply@thesis-platform.com
mail.from-name=Plateforme de Gestion des Thèses
mail.reply-to=support@thesis-platform.com

# ============================================
# Thymeleaf Configuration (for email templates)
# ============================================
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.cache=false

# ============================================
# Actuator & Monitoring
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,loggers
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ============================================
# Logging Configuration
# ============================================
logging.level.root=INFO
logging.level.ma.emsi.notificationservice=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.kafka=DEBUG
logging.level.org.springframework.mail=DEBUG
logging.level.org.hibernate.SQL=DEBUG

# Log file
logging.file.name=logs/notification-service.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================
# Resilience4j Configuration
# ============================================
# Circuit Breaker for Email Service
resilience4j.circuitbreaker.instances.emailService.register-health-indicator=true
resilience4j.circuitbreaker.instances.emailService.sliding-window-size=10
resilience4j.circuitbreaker.instances.emailService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.emailService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.emailService.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.emailService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.emailService.slow-call-rate-threshold=100
resilience4j.circuitbreaker.instances.emailService.slow-call-duration-threshold=5s

# Retry for Email Service
resilience4j.retry.instances.emailService.max-attempts=3
resilience4j.retry.instances.emailService.wait-duration=2s
resilience4j.retry.instances.emailService.enable-exponential-backoff=true
resilience4j.retry.instances.emailService.exponential-backoff-multiplier=2

# Bulkhead for Email Service
resilience4j.bulkhead.instances.emailService.max-concurrent-calls=10
resilience4j.bulkhead.instances.emailService.max-wait-duration=100ms

# Time Limiter
resilience4j.timelimiter.instances.emailService.timeout-duration=10s

# ============================================
# Application Specific Configuration
# ============================================
# Notification settings
notification.batch-size=50
notification.retry-max-attempts=3
notification.retry-delay-seconds=60
notification.dlq-enabled=true
notification.cleanup-days=90

# Email settings
email.enabled=true
email.async=true
email.max-recipients=50
email.rate-limit-per-minute=100

# Push notification settings (for future implementation)
push.enabled=false
push.provider=firebase

# SMS settings (for future implementation)
sms.enabled=false
sms.provider=twilio

# Template settings
template.cache-enabled=true
template.cache-duration-minutes=60
template.default-language=fr

# Priority settings
priority.high.delay-seconds=0
priority.normal.delay-seconds=5
priority.low.delay-seconds=30

# ============================================
# Scheduler Configuration
# ============================================
scheduler.enabled=true
scheduler.cleanup-cron=0 0 2 * * ?
scheduler.retry-dlq-cron=0 */15 * * * ?
scheduler.metrics-cron=0 */5 * * * ?

# ============================================
# Cache Configuration
# ============================================
spring.cache.type=simple
spring.cache.cache-names=templates,preferences,notifications
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=3600s

# ============================================
# Validation Messages
# ============================================
validation.notification.user-id.required=L'identifiant utilisateur est obligatoire
validation.notification.type.required=Le type de notification est obligatoire
validation.notification.message.required=Le message est obligatoire
validation.notification.canal.required=Le canal est obligatoire

# ============================================
# Internationalization
# ============================================
spring.messages.basename=messages
spring.messages.encoding=UTF-8
spring.messages.fallback-to-system-locale=false
