# ============================================
# Configuration complète - Inscription Service
# ============================================

spring.application.name=inscription-service
server.port=8084

# ============================================
# Database Configuration
# ============================================
spring.datasource.url=jdbc:mariadb://localhost:3306/inscription_db
spring.datasource.username=root
spring.datasource.password=amthroot
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# Connection Pool
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ============================================
# JPA/Hibernate Configuration
# ============================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ============================================
# Eureka Client Configuration
# ============================================
eureka.client.service-url.defaultZone=http://eureka:eureka123@localhost:8761/eureka/,http://eureka:eureka123@localhost:8762/eureka/
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90
eureka.client.registry-fetch-interval-seconds=30

# ============================================
# Security & JWT Configuration
# ============================================
jwt.secret=s3cR3tK3y!#2025@JWT_Sign4tur3!!VeryLongSecretKeyForHS512Algorithm2025!!
jwt.expiration=86400000
jwt.refresh-expiration=604800000
jwt.issuer=user-service

# CORS Configuration
cors.allowed-origins=http://localhost:4200,http://localhost:8080
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true

# ============================================
# Kafka Configuration
# ============================================
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.properties.spring.json.add.type.headers=false

# Kafka Topics
kafka.topic.inscription-events=inscription-events
kafka.topic.notification-events=notification-events
kafka.topic.document-events=document-events

# ============================================
# File Upload Configuration
# ============================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.file-size-threshold=2KB

# Upload paths
upload.path=./uploads/inscriptions
upload.documents.path=./uploads/documents
upload.generated.path=./uploads/generated
upload.temp.path=./uploads/temp

# Allowed file types
upload.allowed-extensions=pdf,jpg,jpeg,png,doc,docx
upload.allowed-types=application/pdf,image/jpeg,image/png,image/jpg,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document
upload.max-file-size-mb=10
upload.max-size=10485760
upload.virus-scan.enabled=false

# ============================================
# Actuator & Monitoring
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,loggers
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ============================================
# Logging Configuration
# ============================================
logging.level.root=INFO
logging.level.ma.emsi.inscriptionservice=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Log file
logging.file.name=logs/inscription-service.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================
# Resilience4j Configuration
# ============================================
resilience4j.circuitbreaker.instances.userService.register-health-indicator=true
resilience4j.circuitbreaker.instances.userService.sliding-window-size=10
resilience4j.circuitbreaker.instances.userService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.userService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.userService.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.userService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.userService.slow-call-rate-threshold=100
resilience4j.circuitbreaker.instances.userService.slow-call-duration-threshold=2s

# Retry
resilience4j.retry.instances.userService.max-attempts=3
resilience4j.retry.instances.userService.wait-duration=1s
resilience4j.retry.instances.userService.enable-exponential-backoff=true
resilience4j.retry.instances.userService.exponential-backoff-multiplier=2

# ============================================
# Feign Client Configuration
# ============================================
feign.client.config.default.connect-timeout=5000
feign.client.config.default.read-timeout=10000
feign.client.config.default.logger-level=full

# ============================================
# Application Specific Configuration
# ============================================
# Campagne settings
campagne.default-duration-days=60
campagne.notification-before-end-days=7

# Document validation
document.validation.auto-validate=false
document.validation.require-all-documents=true

# Inscription settings
inscription.max-per-user=5
inscription.allow-multiple-active=false
inscription.auto-submit=false

# Derogation settings
derogation.max-per-inscription=3
derogation.auto-approve=false

# Alert settings
alert.duree-these-warning-months=36
alert.duree-these-critical-months=42
alert.check-interval-days=30

# ============================================
# Cache Configuration
# ============================================
spring.cache.type=simple
spring.cache.cache-names=campagnes,inscriptions,documents
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=600s

# ============================================
# Validation Messages
# ============================================
validation.inscription.cin.required=Le CIN est obligatoire
validation.inscription.cne.required=Le CNE est obligatoire
validation.inscription.email.invalid=L'email n'est pas valide
validation.document.type.required=Le type de document est obligatoire
validation.document.file.required=Le fichier est obligatoire
validation.document.size.exceeded=La taille du fichier dépasse la limite autorisée

# ============================================
# Internationalization
# ============================================
spring.messages.basename=messages
spring.messages.encoding=UTF-8
spring.messages.fallback-to-system-locale=false

# ============================================
# Jackson Configuration
# ============================================
spring.jackson.date-format=yyyy-MM-dd
spring.jackson.serialization.write-dates-as-timestamps=false
