# Application Configuration
spring.application.name=batch-service
server.port=8085

# Eureka Client Configuration
eureka.client.service-url.defaultZone=http://eureka:eureka123@localhost:8761/eureka/,http://eureka:eureka123@localhost:8762/eureka/
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${spring.application.instance_id:${random.value}}

# Primary DataSource - batchdb
spring.datasource.url=jdbc:mariadb://localhost:3306/batchdb?createDatabaseIfNotExist=true
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# HikariCP Configuration for Primary DataSource
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA Configuration
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect
spring.jpa.properties.hibernate.format_sql=true

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration

# Secondary DataSource - userdb
datasource.userdb.jdbc-url=jdbc:mariadb://localhost:3306/userdb
datasource.userdb.username=${DB_USERNAME:root}
datasource.userdb.password=${DB_PASSWORD:root}
datasource.userdb.driver-class-name=org.mariadb.jdbc.Driver
datasource.userdb.hikari.maximum-pool-size=5
datasource.userdb.hikari.minimum-idle=2

# Secondary DataSource - inscriptiondb
datasource.inscriptiondb.jdbc-url=jdbc:mariadb://localhost:3306/inscriptiondb
datasource.inscriptiondb.username=${DB_USERNAME:root}
datasource.inscriptiondb.password=${DB_PASSWORD:root}
datasource.inscriptiondb.driver-class-name=org.mariadb.jdbc.Driver
datasource.inscriptiondb.hikari.maximum-pool-size=5
datasource.inscriptiondb.hikari.minimum-idle=2

# Secondary DataSource - defensedb
datasource.defensedb.jdbc-url=jdbc:mariadb://localhost:3306/defensedb
datasource.defensedb.username=${DB_USERNAME:root}
datasource.defensedb.password=${DB_PASSWORD:root}
datasource.defensedb.driver-class-name=org.mariadb.jdbc.Driver
datasource.defensedb.hikari.maximum-pool-size=5
datasource.defensedb.hikari.minimum-idle=2

# Secondary DataSource - notificationdb
datasource.notificationdb.jdbc-url=jdbc:mariadb://localhost:3306/notificationdb
datasource.notificationdb.username=${DB_USERNAME:root}
datasource.notificationdb.password=${DB_PASSWORD:root}
datasource.notificationdb.driver-class-name=org.mariadb.jdbc.Driver
datasource.notificationdb.hikari.maximum-pool-size=5
datasource.notificationdb.hikari.minimum-idle=2

# Spring Batch Configuration
spring.batch.job.enabled=false
spring.batch.jdbc.initialize-schema=always

# Kafka Configuration
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true

# Kafka Topics
kafka.topic.notifications=notifications

# File Storage Configuration
batch.reports.directory=${REPORTS_DIR:./reports}
batch.archives.directory=${ARCHIVES_DIR:./archives}
batch.uploads.directory=${UPLOADS_DIR:./uploads}

# Archive Configuration
batch.archive.retention.enrollments.years=1
batch.archive.retention.defenses.years=1
batch.archive.retention.logs.application.months=6
batch.archive.retention.logs.notification.months=3

# Encryption Configuration
batch.encryption.algorithm=AES
batch.encryption.key-size=256
batch.encryption.key-vault.url=${KEY_VAULT_URL:}

# Job Scheduling CRON Expressions
batch.job.token-cleanup.cron=0 0 2 * * ?
batch.job.duration-alert.cron=0 0 8 ? * MON
batch.job.monthly-report.cron=0 0 9 1 * ?
batch.job.archive.cron=0 0 3 1 1,4,7,10 ?
batch.job.consistency-check.cron=0 0 23 * * ?

# Chunk Sizes
batch.chunk.token-cleanup=100
batch.chunk.duration-alert=50
batch.chunk.archive=20

# Skip Limits (for fault tolerance)
batch.skip-limit.token-cleanup=10
batch.skip-limit.duration-alert=10
batch.skip-limit.archive=5

# Graceful Degradation Configuration
batch.graceful-degradation.min-disk-space-gb=10
batch.graceful-degradation.kafka-timeout-ms=5000
batch.graceful-degradation.db-connection-timeout-seconds=30

# File Paths
batch.paths.archives=./archives
batch.paths.reports=./reports
batch.paths.uploads=./uploads

# Notification Configuration
batch.notifications.kafka.topic=notifications
batch.notifications.kafka.enabled=true
batch.notifications.email.enabled=true
batch.notifications.email.from=batch-service@emsi.ma
batch.notifications.email.technical-team=${TECHNICAL_TEAM_EMAILS:admin@emsi.ma}

# Email Configuration (for report distribution)
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.health.defaults.enabled=true
management.prometheus.metrics.export.enabled=true
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# Actuator Info Endpoint
info.app.name=Batch Service
info.app.description=Automated batch processing and maintenance tasks for doctoral management portal
info.app.version=1.0.0
info.app.encoding=@project.build.sourceEncoding@
info.app.java.version=@java.version@

# Security Configuration
spring.security.user.name=admin
spring.security.user.password=${ADMIN_PASSWORD:admin}

# JWT Configuration
jwt.secret=${JWT_SECRET:your-secret-key-change-in-production}
jwt.expiration=86400000

# Resilience4j Rate Limiter Configuration
resilience4j.ratelimiter.instances.jobTrigger.limit-for-period=5
resilience4j.ratelimiter.instances.jobTrigger.limit-refresh-period=60s
resilience4j.ratelimiter.instances.jobTrigger.timeout-duration=0s

# Logging Configuration
logging.level.root=INFO
logging.level.ma.emsi.batchservice=DEBUG
logging.level.org.springframework.batch=INFO
logging.level.org.springframework.kafka=INFO
logging.file.name=logs/batch-service.log
logging.file.max-size=10MB
logging.file.max-history=30

# SpringDoc OpenAPI Configuration
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
springdoc.show-actuator=false
