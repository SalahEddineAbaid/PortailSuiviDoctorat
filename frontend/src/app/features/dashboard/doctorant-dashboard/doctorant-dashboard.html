<div class="dashboard-layout">
  <!-- Sidebar -->
  <app-sidebar [menuItems]="menuItems"></app-sidebar>

  <!-- Main Content -->
  <div class="dashboard-main">
    <!-- Navbar -->
    <app-navbar [user]="dashboard?.user || null"></app-navbar>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- Header -->
      <div class="dashboard-header">
        <div class="welcome-section">
          <h1>{{ getWelcomeMessage() }}, {{ getUserName() }} üëã</h1>
          <p class="subtitle">Voici un aper√ßu de votre progression</p>
        </div>
        <button class="btn-refresh" (click)="refreshDashboard()" [disabled]="isLoading">
          <i class="fas fa-sync-alt" [class.spinning]="isLoading"></i>
          Actualiser
        </button>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        {{ error }}
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <div class="spinner"></div>
        <p>Chargement de votre dashboard...</p>
      </div>

      <!-- Dashboard Content -->
      <div *ngIf="!isLoading && dashboard" class="dashboard-grid">
        
        <!-- Row 1: Statistics Cards -->
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-icon primary">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.statistics.totalInscriptions }}</h3>
              <p>Inscriptions totales</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon success">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.statistics.inscriptionsValidees }}</h3>
              <p>Inscriptions valid√©es</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon warning">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.statistics.inscriptionsEnAttente }}</h3>
              <p>En attente</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon danger">
              <i class="fas fa-folder-open"></i>
            </div>
            <div class="stat-content">
              <h3>{{ dashboard.statistics.documentsManquants }}</h3>
              <p>Documents manquants</p>
            </div>
          </div>
        </div>

        <!-- Row 2: Progression & Quick Actions -->
        <div class="content-row">
          <!-- Progression Widget -->
          <div class="widget progression-widget">
            <div class="widget-header">
              <h2><i class="fas fa-chart-line"></i> Progression de la th√®se</h2>
            </div>
            <div class="widget-body">
              <div class="progress-circle">
                <svg viewBox="0 0 100 100">
                  <circle cx="50" cy="50" r="45" class="progress-bg"></circle>
                  <circle 
                    cx="50" 
                    cy="50" 
                    r="45" 
                    class="progress-bar"
                    [style.stroke-dashoffset]="283 - (283 * getProgressPercentage() / 100)"
                  ></circle>
                </svg>
                <div class="progress-text">
                  <span class="percentage">{{ getProgressPercentage() }}%</span>
                  <span class="label">Compl√©t√©</span>
                </div>
              </div>
              
              <div class="progress-details">
                <div class="detail-item">
                  <span class="label">√âtape actuelle</span>
                  <span class="value">{{ dashboard.progression.etapeActuelle }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">√âtapes compl√©t√©es</span>
                  <span class="value">{{ dashboard.progression.etapesCompletees }} / {{ dashboard.progression.etapesTotales }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Dur√©e √©coul√©e</span>
                  <span class="value">{{ dashboard.progression.dureeEcoulee }} mois</span>
                </div>
                <div class="detail-item">
                  <span class="label">Prochaine milestone</span>
                  <span class="value highlight">{{ dashboard.progression.prochaineMilestone }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions Widget -->
          <div class="widget quick-actions-widget">
            <div class="widget-header">
              <h2><i class="fas fa-bolt"></i> Actions rapides</h2>
            </div>
            <div class="widget-body">
              <div class="quick-actions-grid">
                <a 
                  *ngFor="let action of dashboard.quickActions" 
                  [routerLink]="action.route"
                  class="quick-action-card"
                  [class]="'color-' + action.color"
                >
                  <i [class]="'fas fa-' + action.icon"></i>
                  <span>{{ action.label }}</span>
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 3: Inscriptions & Notifications -->
        <div class="content-row">
          <!-- Inscriptions Widget -->
          <div class="widget inscriptions-widget">
            <div class="widget-header">
              <h2><i class="fas fa-list"></i> Mes inscriptions</h2>
              <a routerLink="/inscription/list" class="view-all">Voir tout</a>
            </div>
            <div class="widget-body">
              <div *ngIf="!hasInscriptions()" class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Aucune inscription pour le moment</p>
                <a routerLink="/inscription/new" class="btn-primary">Cr√©er une inscription</a>
              </div>

              <div *ngIf="hasInscriptions()" class="inscriptions-list">
                <div 
                  *ngFor="let inscription of dashboard.inscriptions" 
                  class="inscription-item"
                  [class.clickable]="inscription.canEdit"
                  [routerLink]="inscription.canEdit ? ['/inscription', inscription.id] : null"
                >
                  <div class="inscription-info">
                    <h4>{{ inscription.anneeUniversitaire }}</h4>
                    <p class="campagne">{{ inscription.campagneNom }}</p>
                    <p class="date">Cr√©√©e le {{ inscription.dateCreation | date:'dd/MM/yyyy' }}</p>
                  </div>
                  <div class="inscription-status">
                    <span class="badge" [class]="'badge-' + inscription.statut.toLowerCase()">
                      {{ inscription.statut }}
                    </span>
                    <span *ngIf="inscription.documentsManquants > 0" class="warning-badge">
                      {{ inscription.documentsManquants }} doc(s) manquant(s)
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Notifications Widget -->
          <div class="widget notifications-widget">
            <div class="widget-header">
              <h2>
                <i class="fas fa-bell"></i> 
                Notifications r√©centes
                <span *ngIf="getNotificationCount() > 0" class="badge-count">{{ getNotificationCount() }}</span>
              </h2>
              <a routerLink="/notifications" class="view-all">Voir tout</a>
            </div>
            <div class="widget-body">
              <div *ngIf="!hasNotifications()" class="empty-state">
                <i class="fas fa-bell-slash"></i>
                <p>Aucune notification</p>
              </div>

              <div *ngIf="hasNotifications()" class="notifications-list">
                <div 
                  *ngFor="let notification of dashboard.notifications" 
                  class="notification-item"
                  [class.unread]="!notification.lu"
                >
                  <div class="notification-icon" [class]="'priority-' + notification.priorite">
                    <i class="fas fa-info-circle"></i>
                  </div>
                  <div class="notification-content">
                    <h4>{{ notification.titre }}</h4>
                    <p>{{ notification.message }}</p>
                    <span class="notification-date">{{ notification.dateCreation | date:'dd/MM/yyyy HH:mm' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
