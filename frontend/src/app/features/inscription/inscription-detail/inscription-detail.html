<div class="inscription-detail-container" *ngIf="!loading && inscription">
  <!-- Header -->
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        <div class="title-section">
          <div>
            <mat-icon>description</mat-icon>
            Inscription #{{ inscription.id }}
          </div>
          <mat-chip [style.background-color]="getStatutColor(inscription.statut)" selected class="status-chip">
            {{ getStatutLabel(inscription.statut) }}
          </mat-chip>
        </div>
      </mat-card-title>
      <mat-card-subtitle>
        {{ getTypeLabel(inscription.type) }} - Année {{ inscription.anneeInscription }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-actions>
      <button mat-button (click)="onBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour
      </button>
      <button mat-raised-button color="primary" (click)="onEdit()" [disabled]="!canEdit()">
        <mat-icon>edit</mat-icon>
        Modifier
      </button>
      <button mat-raised-button color="accent" (click)="onDownloadAttestation()" [disabled]="!canDownloadAttestation()">
        <mat-icon>download</mat-icon>
        Attestation
      </button>
    </mat-card-actions>
  </mat-card>

  <!-- Tabs -->
  <mat-tab-group class="detail-tabs">
    <!-- Informations générales -->
    <mat-tab label="Informations">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Sujet de thèse</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p>{{ inscription.sujetThese }}</p>
          </mat-card-content>
        </mat-card>

        <div class="info-grid">
          <!-- Informations personnelles -->
          <mat-card>
            <mat-card-header>
              <mat-icon mat-card-avatar>person</mat-icon>
              <mat-card-title>Informations Personnelles</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-list>
                <mat-list-item>
                  <mat-icon matListItemIcon>badge</mat-icon>
                  <div matListItemTitle>CIN</div>
                  <div matListItemLine>{{ inscription.infosDoctorant.cin }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item *ngIf="inscription.infosDoctorant.cne">
                  <mat-icon matListItemIcon>school</mat-icon>
                  <div matListItemTitle>CNE</div>
                  <div matListItemLine>{{ inscription.infosDoctorant.cne }}</div>
                </mat-list-item>
                <mat-divider *ngIf="inscription.infosDoctorant.cne"></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>phone</mat-icon>
                  <div matListItemTitle>Téléphone</div>
                  <div matListItemLine>{{ inscription.infosDoctorant.telephone }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>location_on</mat-icon>
                  <div matListItemTitle>Adresse</div>
                  <div matListItemLine>{{ inscription.infosDoctorant.adresse }}, {{ inscription.infosDoctorant.ville }}, {{ inscription.infosDoctorant.pays }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>cake</mat-icon>
                  <div matListItemTitle>Date de naissance</div>
                  <div matListItemLine>{{ inscription.infosDoctorant.dateNaissance | date:'dd/MM/yyyy' }} à {{ inscription.infosDoctorant.lieuNaissance }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>flag</mat-icon>
                  <div matListItemTitle>Nationalité</div>
                  <div matListItemLine>{{ inscription.infosDoctorant.nationalite }}</div>
                </mat-list-item>
              </mat-list>
            </mat-card-content>
          </mat-card>

          <!-- Informations de thèse -->
          <mat-card>
            <mat-card-header>
              <mat-icon mat-card-avatar>menu_book</mat-icon>
              <mat-card-title>Informations de Thèse</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-list>
                <mat-list-item>
                  <mat-icon matListItemIcon>title</mat-icon>
                  <div matListItemTitle>Titre</div>
                  <div matListItemLine>{{ inscription.infosThese.titreThese }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>category</mat-icon>
                  <div matListItemTitle>Discipline</div>
                  <div matListItemLine>{{ inscription.infosThese.discipline }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>science</mat-icon>
                  <div matListItemTitle>Laboratoire</div>
                  <div matListItemLine>{{ inscription.infosThese.laboratoire }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>business</mat-icon>
                  <div matListItemTitle>Établissement</div>
                  <div matListItemLine>{{ inscription.infosThese.etablissementAccueil }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
                
                <mat-list-item>
                  <mat-icon matListItemIcon>event</mat-icon>
                  <div matListItemTitle>Date de début prévue</div>
                  <div matListItemLine>{{ inscription.infosThese.dateDebutPrevue | date:'dd/MM/yyyy' }}</div>
                </mat-list-item>
                
                <mat-divider *ngIf="inscription.infosThese.cotutelle"></mat-divider>
                <mat-list-item *ngIf="inscription.infosThese.cotutelle">
                  <mat-icon matListItemIcon>public</mat-icon>
                  <div matListItemTitle>Cotutelle</div>
                  <div matListItemLine>{{ inscription.infosThese.universitePartenaire }} ({{ inscription.infosThese.paysPartenaire }})</div>
                </mat-list-item>
              </mat-list>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Dates -->
        <mat-card>
          <mat-card-header>
            <mat-card-title>Dates importantes</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="dates-grid">
              <div class="date-item">
                <mat-icon>add_circle</mat-icon>
                <div>
                  <div class="date-label">Création</div>
                  <div class="date-value">{{ inscription.dateCreation | date:'dd/MM/yyyy HH:mm' }}</div>
                </div>
              </div>
              
              <div class="date-item" *ngIf="inscription.dateValidation">
                <mat-icon>check_circle</mat-icon>
                <div>
                  <div class="date-label">Validation</div>
                  <div class="date-value">{{ inscription.dateValidation | date:'dd/MM/yyyy HH:mm' }}</div>
                </div>
              </div>
              
              <div class="date-item" *ngIf="inscription.dureeDoctorat">
                <mat-icon>schedule</mat-icon>
                <div>
                  <div class="date-label">Durée du doctorat</div>
                  <div class="date-value">{{ inscription.dureeDoctorat }} mois</div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Documents -->
    <mat-tab label="Documents">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Documents uploadés ({{ inscription.documents.length }})</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-list *ngIf="inscription.documents.length > 0">
              <mat-list-item *ngFor="let doc of inscription.documents; let last = last">
                <mat-icon matListItemIcon [color]="doc.valide ? 'primary' : 'accent'">
                  {{ doc.valide ? 'check_circle' : 'pending' }}
                </mat-icon>
                <div matListItemTitle>{{ doc.nomFichier }}</div>
                <div matListItemLine>
                  {{ doc.typeDocument }} - {{ doc.tailleFichier | number }} octets
                  <span *ngIf="doc.dateUpload"> - Uploadé le {{ doc.dateUpload | date:'dd/MM/yyyy' }}</span>
                </div>
                <button mat-icon-button matListItemMeta (click)="onDownloadDocument(doc.id, doc.nomFichier)">
                  <mat-icon>download</mat-icon>
                </button>
                <mat-divider *ngIf="!last"></mat-divider>
              </mat-list-item>
            </mat-list>
            
            <div class="no-data" *ngIf="inscription.documents.length === 0">
              <mat-icon>folder_open</mat-icon>
              <p>Aucun document uploadé</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Validations -->
    <mat-tab label="Validations">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Historique des validations</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="timeline" *ngIf="inscription.validations && inscription.validations.length > 0">
              <div class="timeline-item" *ngFor="let validation of inscription.validations">
                <div class="timeline-icon" [ngClass]="getValidationColor(validation.statut)">
                  <mat-icon>{{ getValidationIcon(validation.statut) }}</mat-icon>
                </div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <strong>{{ validation.typeValidateur }}</strong>
                    <span class="timeline-date">{{ validation.dateValidation | date:'dd/MM/yyyy HH:mm' }}</span>
                  </div>
                  <div class="timeline-body">
                    <p><strong>Validateur:</strong> {{ validation.validateurNom }}</p>
                    <p><strong>Statut:</strong> {{ validation.statut }}</p>
                    <p *ngIf="validation.commentaire"><strong>Commentaire:</strong> {{ validation.commentaire }}</p>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="no-data" *ngIf="!inscription.validations || inscription.validations.length === 0">
              <mat-icon>history</mat-icon>
              <p>Aucune validation enregistrée</p>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Commentaires -->
        <mat-card *ngIf="inscription.commentaireDirecteur || inscription.commentaireAdmin">
          <mat-card-header>
            <mat-card-title>Commentaires</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-expansion-panel *ngIf="inscription.commentaireDirecteur">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>person</mat-icon>
                  Commentaire du directeur
                </mat-panel-title>
              </mat-expansion-panel-header>
              <p>{{ inscription.commentaireDirecteur }}</p>
            </mat-expansion-panel>

            <mat-expansion-panel *ngIf="inscription.commentaireAdmin">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>admin_panel_settings</mat-icon>
                  Commentaire de l'administration
                </mat-panel-title>
              </mat-expansion-panel-header>
              <p>{{ inscription.commentaireAdmin }}</p>
            </mat-expansion-panel>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Dérogation -->
    <mat-tab label="Dérogation" *ngIf="inscription.derogation">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <mat-icon>warning</mat-icon>
              Demande de dérogation
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Motif:</strong> {{ inscription.motifDerogation }}</p>
            <p *ngIf="inscription.dureeDoctorat">
              <strong>Durée du doctorat:</strong> {{ inscription.dureeDoctorat }} mois
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- Loading -->
<div class="loading-container" *ngIf="loading">
  <mat-spinner></mat-spinner>
  <p>Chargement...</p>
</div>

<!-- Error -->
<mat-card class="error-card" *ngIf="error && !loading">
  <mat-card-content>
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="onBack()">
      Retour à la liste
    </button>
  </mat-card-content>
</mat-card>
