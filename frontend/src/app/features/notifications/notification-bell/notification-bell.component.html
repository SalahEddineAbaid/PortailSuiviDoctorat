<div class="notification-bell" 
     [class.has-notifications]="(unreadCount$ | async)! > 0"
     [class.new-notification]="hasNewNotifications">
  
  <!-- Bell Icon Button -->
  <button class="bell-button" 
          (click)="toggleDropdown()"
          [attr.aria-label]="'Notifications (' + (unreadCount$ | async) + ' non lues)'"
          [attr.aria-expanded]="isDropdownOpen">
    
    <mat-icon class="bell-icon">notifications</mat-icon>
    
    <!-- Badge de compteur -->
    <span class="notification-badge" 
          *ngIf="(unreadCount$ | async)! > 0"
          [class.pulse]="hasNewNotifications">
      {{ (unreadCount$ | async)! > 99 ? '99+' : (unreadCount$ | async) }}
    </span>
  </button>

  <!-- Dropdown -->
  <div class="notification-dropdown" 
       *ngIf="isDropdownOpen"
       [@slideDown]>
    
    <!-- Header -->
    <div class="dropdown-header">
      <h3>Notifications</h3>
      <div class="header-actions">
        <button class="icon-button" 
                (click)="markAllAsRead()"
                [disabled]="(unreadCount$ | async) === 0"
                matTooltip="Tout marquer comme lu">
          <mat-icon>done_all</mat-icon>
        </button>
        <button class="icon-button" 
                (click)="closeDropdown()"
                matTooltip="Fermer">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <!-- Liste des notifications -->
    <div class="dropdown-content">
      <ng-container *ngIf="(notifications$ | async) as notifications">
        <!-- Notifications prÃ©sentes -->
        <div *ngIf="notifications.length > 0" class="notifications-list">
          <app-notification
            *ngFor="let notification of notifications.slice(0, 5); trackBy: trackByNotificationId"
            [notification]="notification"
            [compact]="true"
            [showActions]="false"
            (notificationClicked)="onNotificationClick($event)">
          </app-notification>
        </div>

        <!-- Aucune notification -->
        <div *ngIf="notifications.length === 0" class="empty-state">
          <mat-icon>notifications_none</mat-icon>
          <p>Aucune notification</p>
        </div>
      </ng-container>
    </div>

    <!-- Footer -->
    <div class="dropdown-footer">
      <button class="view-all-button" 
              routerLink="/notifications"
              (click)="closeDropdown()">
        Voir toutes les notifications
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
  </div>

  <!-- Overlay pour fermer le dropdown -->
  <div class="dropdown-overlay" 
       *ngIf="isDropdownOpen"
       (click)="closeDropdown()">
  </div>
</div>
